<?php
 namespace imwpf\modules\condition; class Condition { protected $callback; public function setCallback(callable $cb) { $this->callback = $cb; } public function parse($condstr) { $conditions = array(); $sections = explode("|", $condstr); foreach ($sections as $section) { $conditions[] = explode(",", $section); } return $conditions; } public function pass(array $conditions) { foreach ($conditions as $section) { if ($this->sectionPass($section)) { return true; } } return false; } public function sectionPass(array $items) { if (!$this->callback) { throw new \Exception("需要设置条件判断函数", 1); } $cb = $this->callback; foreach ($items as $item) { if ($cb($item) === false) { return false; } } return true; } }